# Oops! I Shrink My Web Server
##Speaker: Ben Lue
##記錄：胡學賓、張維元

我先自我介紹一下。大概在兩千年的時候，我在美國創立一間公司叫 Netclue ，以 Java 實作網路瀏覽器，每個應用程式可以包含在一個瀏覽器裏頭，當時的夢想是希望改變所有人寫程式的方法（差點就成功了！）。當時美國的通用汽車公車找上我們，還簽了台幣價值六億的合約，那時前後有三家公司找我們併購，還派好萊塢加長禮車到機場接我們。

因為這樣的一層關係，我一直以為我跟 Java 是長期的戰友，我們可以白頭到老。不過後來隨著 Java 的語言改變，讓我覺得寫程式越來越像在做打字練習，不像在寫程式。同樣一件事情 node.js 可以簡單做到，Java 卻像老學究一般，越來越囉嗦且難以溝通。於是大概在去年的這個時間，我決定跳船改用 node.js，但跳船是要付出代價的，就是我們公司的殺手級（公司產品名稱）應用程式都要重寫。原本的版本從 2010 年七月開始，花費約三年時間完成。中間有接一些專案（還是需要養活自己嘛）還有將 code 整個砍掉重練。裡面大概包含三個小的 project，不算太大。改成 node.js 的版本花不到三個月（不包含計畫時間）。這樣的時間比較是不公平的，因為先前花很多時間去構思。但最終我們將 project 從三個縮減到兩個，程式碼大概只需要原來的五分之一不到。這樣的成果是不是特例呢？

不是喔！

## Node.js 的崛起

2013 年ＯＯ公司在更新解釋帳號的系統中，也發現類似的結果。程式語言 C 從1973年開始發展，大概花了 20 年才漸趨成熟。 Java 從 1995 年十月公告出來後花了 10 年就達成了。 Node 從 2009 有正式的雛形，那因為效率跟語言彈性的部份，Node 只花了5年時間，時間花費非常漂亮的都切在一半一半。我相信在座的各位都同意 node 這個語言在讓開發時程可以縮短很多。很奇怪的，在 Node 上有沒有比較好的 Web Framework呢？這答案就是見仁見智了。Ruby 有 ROR ，那 Node呢？

所以我們希望在 Node 的開發上能做到幾件事情：
一、簡省開發時間縮短到一半
二、縮短維護時間到三分之一

## coSrev

Node 是一個工具，而工具的本質是在釋放大家，讓大家自由，激發創造力。如果 framework 像 angular 這樣有太多自己的語法，那開發會像鍋牛一樣背負著太多規則。以開發的角度來看，我們希望花時間在 Coding ，而非在學習 Tool ，所以選擇CP值高的工具是很重要的。
再來要介紹 Ruby 的好朋友：不會比他差，只會更好的－－ coSrev

coSrev 完全以note 來試做的，總共只用一千多行的程式架設的 coSrev 有以下特點

一、乾淨的 MVC 架構
二、強大的樣版引擎（超過樣板引擎的規範，更有用）
三、簡單的支援多國語系
四、容易掛上好幾個網站
五、特別的CSS前置處理器
六、不喜歡的地方就自己改，反正只有一千多行

為什麼一千多行的程式可以做到這麼多？其實這也不是很神奇的事情，divide & conquer，像 Yahoo 複雜的網頁也需要花一些時間，如果我們將它切割成小塊分別處理，再將之合起來，這樣可以節省很多，coSrev 就是以這樣的原理進行，讓我們有比較好的機會可以 reuse，假如我們將網頁這樣分（p0，p1，p2），但是我們可能要作十個功能（3＋3＋4），然而網頁其中的功能可能重複。而 coSrev 就是希望我們不要重複做這些功能。 Don’t repeat yourself.


##（實際操作）

處理前端煩人問題的 Collsion，我們大部份會以 .title div 取代 .div 來避免，因為 div 太常用了，很快就會出現問題。但是程式太大的時候，就需要取很多名字去達到這個效果。coSrev 早期的程式語言沒有 scope，必須想很多奇奇怪怪的變數名稱避免衝撞。然而現在我們有 coSrev ，coSrev 能像先前提到的，將網頁程式切割成多個區塊，個區塊內的名稱重複機率就不會像為切割前高。Encapsulation 封裝的方式，保護 Css，就像加一個 scope 一樣。

下面我們就來講講怎麼特製一個網頁，以版權宣告為例，年份的更改可以看投影片的方式，getFullYear() 的做到，html 的用法跟 ejx.js 的用法類似 (<%= %>)，不管你是用 post 或是 get，會把外界的物件重新封裝一個 JSON 的物件，

* 畫面切割
* CSS 撞名
* 客製化功能

coserv 沒有要求大家學習新的東西，沒有新的語法，你只要有 html 的 css 的基礎就可以，但是被要求用新的角度跟視野來看就的問題，

## 網頁的處理流程

JASS，開了 SASS 的小玩笑（ruby），讓你在 CSS 檔案可以嵌入 js 程式碼，用 js 物件處理 CSS 屬性，印出來的時候再印成 CSS 語法，透過這些簡單的方式就可以把 SASS 達到的目的解決，今年只能介紹幾個比較特別的東西

麻煩大家看一下幾個程式碼，做圓角的 CSS 語法，需要針對不同的瀏覽器做不同的寫法，這是一個不 reuse 的性質，今天我們可以改用 js 的特性，下面這兩行的用法就可以讓寫法簡單很多，事實上這就是 sass 的 mixin，彈性變得更大

今天要做一個天氣的 app，想在背景上做變化，根據天氣邊畫顯示不同的背景，我相信你找不到一個更簡單的話，這是一個 JASS 的處理方式，我們寫一個 func，把天氣當成參數傳述，回傳一個背影圖給 html，透過這樣就解決的背景處理的問題，不用像 angular 學很多新的寫法。

最後再講一下，跟 bootstap 或是 semantic ui 有關的內容，他們可以是一種很容易懂的 CSS 寫法，如果你是用 coserve 也可以有很輕鬆的寫法，把 selector 傳進去，回傳性質回來()

在高雄辦了一個 coserv 的黑客松，吃吃喝喝邊寫 code 很快樂，發現一件事情，現在這個時代跟過去不一樣，在過去的開發者，程式語言的工具是比較少的，現在是一個工具爆炸的時代，所以問題可能是不知道要用什麼工具，所以常常花很多時間在查資料要怎樣用 framework 而非花時間在寫 code，這樣樂趣就少了很多。對開發者來說，就像在看電影每五分鐘就插入廣告，重新簡化過，不需學一些複雜的 framework，希望把最基本的東西學精學熟（html、css、js）。

因為還有時間，我們來 show 一下一些 demo，因為有充足時間所以也可以問問題，這是一個 coserv 的 demo，他支援多國語系，他在裡面是用一個範例檔來做的，我們如果看他的範例的話，這是一個簡單的範例檔，他得多國語係是這樣處理的˙，基本上就是 xml 檔，不同的語系就用不同的 tag 來表示，中文的話就 <zh></zh>，英文的話就 <en></en>，

## 資料流程整合

整合跨網站資料，一個瀏覽器跟很多個 server 要資料，coserv server 可以透過 node 的程式送一個 http req 給其它 server 把資料要回來傳給 client

區塊重複使用，按首頁的時候，換了不同範例的時候內容（頁面）是轉變得但是網址並沒有便，這就是單頁式網頁，今天如果一個區塊是 BBC rss 內容，點另外一個區塊的時候也是要去其他網站 rss 的資料，就可以重複使用這個功能（再呼叫一次）在寫回去原本的內容，或是使用更簡單的方式，在網頁裡面包含了兩個 rss 區塊，會發現顯示兩個區塊的程式碼比顯示一塊還要短，這就是重複使用的 power，大概做一次就可以重複引用，像是 menu 就很需要

我們支援了 SASS 的功能，最新版的時候發現可以不用借助 SASS，改用 JAVA 自己的方式就可以自己做了，最後講一下這個 blog，剛剛已經玩過魔術給大家看過了（將網址改成.hf），再來一次，可以將每個區塊各自做出來，在針對每個區塊 debug，如果出問題的話，不是 view 就是 model，可以切一半檢查，在 Coserv 可以將網址改成 .wsj，它的功能會將 model 傳回來，如果你要檢查是 view 還是 model 有問題，就可以透過 wsj，將 json 回傳回來檢查，若是 model 沒問題很顯然就是 view 的問題，如果 view 沒問題就要去找後端工程師了，後端工程師要去想辦法解決這個問題。

另外，切換不同的背景，Coserv 可以在 layout 中決定網頁內容長什麼樣子，，當網頁越來越多 router 會變得很難看，因為每一頁都要一個設定，siteURI.json 可以做 routing 做控制，嚴格地執行 MVC，BASS，網路開發的一種新的趨勢，從後面拿出資料的成本越來越高，自己寫很麻煩，所以 BASS 幫你解決這種問題，資料庫早期是關聯式資料庫，跟最近的 nosql，這兩種資料庫各有優缺點，當資料關聯性非常高的時候用關聯式來做會比較好，但當資料是扁平式的且關聯性不多用 nosql 比較好，開發者在做選擇上會很兩難，於是 BASS 就在做這個服務，不用去考慮背後細節是怎麼處理的。

## 關鍵字

* flux react
* coServe
* prefix
* json
* hf = return  html fragment
* C : 1973年發展成熟
* css前置處理器
*  jass
* sass
* mixin
* Semantic UI
* cross site
* cross orig
* siteURI
* express
* MVC
* data source
* file system